<!DOCTYPE html><html lang="ja"> <head><title>JavaScriptでビットベクタルを使う | メモログ</title><meta name="description" content="塵が積もって山とならないメモのログ" id="meta-description"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="shortcut icon" href="/assets/icons/icon-32.ico"><style>
  :root {
    --container-width: 985px;
    --link-color: #694b16;
    --background-color: #e3ded5;
    --lighter-color: #fdf8ee;
    --darker-color: #cac5bc;
    --more-dark-color: #b1aca4;
    --border-color: #cac5bc;
    --profile-text-color: #55514a;
    --article-background-color: white;
    --profile-background-color: var(--border-color);
    --border-radius: 10px;
    --pagination-item-width: 61px;
    --featured-caption-color: #534f48;
  }

  * {
    box-sizing: border-box;
  }

  body {
    background-color: var(--background-color);
    color: black;
    font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue",
      "Hiragino Kaku Gothic Pro", YuGothic, "Yu Gothic", Meiryo, sans-serif;
    margin: 0;
    padding: 0;
  }

  a {
    color: var(--link-color);
  }

  .header {
    margin: 0 auto;
    font-family: Garamond, "Times New Roman", serif;
  }

  .header:has(.featured__image) {
    margin-bottom: 2em;
  }

  .header_component_global {
    width: 100%;
  }

  .header-inner {
    text-align: center;
    margin: 5px auto;
    max-width: var(--container-width);
    display: grid;
    grid-template-columns: 36px 96px auto;
    align-items: center;
  }

  .header__icon {
    justify-self: end;
  }

  .header__title {
    margin: 0.2em 0 0.2em;
    font-size: 1.8em;
    font-weight: normal;
    vertical-align: bottom;
  }

  .header__title a,
  .header__title > span {
    color: black;
    text-decoration: none;
  }

  .header_component_global .header__title {
    font-family: sans-serif;
    font-size: 14px;
    line-height: 16px;
    font-weight: bold;
    justify-self: start;
  }

  .header_component_global .header__title a {
    text-decoration: none;
    color: black;
    padding: 7px 5px;
    background-color: transparent;
  }

  .header_component_global .navigation-global {
    justify-self: end;
    padding-right: 10px;
    font-family: sans-serif;
  }

  .header__description {
    margin-top: 0;
    margin-bottom: 1em;
  }

  .header_component_global .header__description {
    color: #666;
    margin: 0 auto;
    padding: 0 5px;
  }

  .header__epigraph {
    font-style: italic;
    color: #666;
    margin: 0 auto;
    padding: 5px;
  }

  .container {
    width: var(--container-width);
    max-width: 100%;
    margin: 0 auto 4em;
    padding: 0;
    border-radius: var(--border-radius);
  }

  article {
    background-color: var(--article-background-color);
    padding: 2em;
    border-radius: var(--border-radius);
  }

  .content {
    font-size: 1.125em;
    line-height: 2em;
    background: var(--article-background-color);
    color: #222;
    -webkit-font-smoothing: antialiased;
  }

  .read-more {
    margin-top: 1em;
  }

  .content h2,
  .content h3 {
    font-size: 1.4em;
    margin: 2em 0 1em 0;
    border-bottom: 1px solid #ddd;
  }

  .article-summary {
    margin-bottom: 3.5em;
  }

  .header time {
    display: inline-block;
    font-size: 0.8125em;
    color: #666;
    font-family: sans-serif;
  }

  .calendar-icon,
  .author-icon {
    margin-right: 0.5em;
  }

  .content blockquote {
    border: 5px solid var(--border-color);
    background: var(--lighter-color);
    margin: 1.5em 0;
    padding: 0 1em;
    border-radius: var(--border-radius);
  }

  .content p > code,
  .content li > code {
    background-color: #f5f2f0;
    display: inline-block;
    padding: 0 6px;
    border-radius: var(--border-radius);
    color: #444;
  }

  .content table {
    background: #e0e0e0;
  }

  .content th {
    background: #f0f0f0;
  }

  .content tr {
    background: #fff;
  }

  .content tr:nth-child(even) {
    background: #f0f0f0;
  }

  .content td {
    padding: 5px 1em;
    text-align: center;
  }

  .header__feature {
    margin: 0.5em 0 -0.5em;
    position: relative;
  }

  .header__feature img {
    overflow: hidden;
  }

  .featured__image {
    background: #f5f2f0;
    line-height: 0;
    overflow: hidden;
    margin: 0 -32px;
  }

  .featured__image picture {
    display: block;
    height: auto;
    width: 100%;
  }

  .featured__image img {
    width: 100%;
    object-fit: cover;
    height: auto;
    aspect-ratio: 3 / 1;
  }

  .featured__credit {
    color: #333;
    font-size: 0.825em;
    text-align: right;
    position: absolute;
    right: 0;
    bottom: 0;
    padding: 7px;
    background: #f0f0f0;
    opacity: 0.8;
  }

  .featured__credit a {
    color: #333;
  }

  .lazyload,
  .lazyloading {
    opacity: 0.5;
  }

  .lazyloaded {
    opacity: 1;
    transition: opacity 2s 0.3s cubic-bezier(0.3, 0.18, 0.15, 1);
  }

  .content img {
    max-width: 100%;
  }

  .content img.screenshot {
    display: block;
    height: auto;
    max-width: 100%;
    object-fit: contain;
    border: 4px solid var(--border-color);
    border-radius: var(--border-radius);
  }

  .youtube-wrapper {
    position: relative;
    display: block;
    height: 0;
    padding: 0;
    overflow: hidden;
    padding-bottom: 56.25%;
  }

  .youtube-wrapper iframe {
    position: absolute;
    top: 0;
    left: 0;
    bottom: 0;
    height: 100%;
    width: 100%;
    border: 0;
  }

  .related-posts > div {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(355px, 1fr));
    gap: 20px;
  }

  .related-posts h2 {
    font-size: 1em;
    font-weight: normal;
    margin: 2.5em 0 0.5em 0.5em;
    color: var(--profile-text-color);
  }

  .related-posts article {
    padding: 20px 15px;
    margin-bottom: 0;
  }

  .related-posts article .header:has(.featured__image) {
    margin-bottom: 1em;
  }

  .related-posts .article__title {
    font-size: 1.2em;
  }

  .related-posts .content {
    font-size: 1em;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 3;
    overflow: hidden;
  }

  .related-posts .featured__image {
    margin-left: -15px;
    margin-right: -15px;
  }

  .related-posts .featured__credit {
    display: none;
  }

  .profile {
    border: 1px solid var(--profile-background-color);
    padding: 1em;
    margin-top: 2em;
    color: var(--profile-text-color);
    border-radius: var(--border-radius);
    background: var(--profile-background-color);
  }

  .profile__heading {
    margin-bottom: 0.3em;
    margin-top: 0;
    border-bottom: 1px dashed var(--profile-text-color);
    display: inline-block;
    font-weight: bold;
    font-family: Garamond, "Times New Roman", serif;
  }

  .profile__image {
    float: left;
    margin-right: 6px;
  }

  .profile__content {
    overflow: hidden;
    font-family: sans-serif;
    line-height: 1.5em;
  }

  .navigation__link,
  .profile__content a {
    color: var(--profile-text-color);
  }

  .profile__social-list {
    margin: 0.5em 0 0 0;
    padding: 0;
    list-style-type: none;
  }

  .profile__social-list-item {
    display: inline;
    margin-right: 0.5em;
  }

  .content hr {
    border-top-width: 0;
    border-bottom-width: 1;
    border-style: solid;
    border-color: #ddd;
    margin-top: 4em;
  }

  .pagination {
    display: grid;
    grid-template-columns: repeat(auto-fit, var(--pagination-item-width));
    gap: 10px;
    align-items: center;
    justify-items: center;
    justify-content: center;
    margin: 0;
  }

  .page-number,
  .extend.next,
  .extend.prev,
  .pagination .space {
    width: 100%;
    text-align: center;
    line-height: var(--pagination-item-width);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    background: var(--background-color);
  }

  .pagination .space {
    border-color: transparent;
  }

  .page-number.current {
    background: var(--darker-color);
    font-weight: bold;
    color: white;
    border-color: var(--darker-color);
  }

  .post .writing-vertical {
    writing-mode: vertical-rl;
    font-family: serif;
    font-size: 1em;
    margin: 1.5em 0;
    column-count: 2;
    max-width: var(--container-width);
    width: 102%;
    overflow: auto;
    height: 800px;
  }

  .post .writing-vertical p {
    margin: 0;
  }

  .post .writing-vertical p:first-letter {
    margin-top: 1em;
  }

  .post .writing-vertical .link-icon {
    background-position-x: center;
    background-position-y: 5px;
  }

  .post .writing-vertical blockquote {
    border: none;
    margin: 0 0.5em;
    padding: 1em 0.5em;
    background: #f0f0f0;
  }

  pre[class*="language-"] {
    border: 4px solid var(--border-color);
    font-size: 16px;
    border-radius: var(--border-radius);
  }

  @media screen and (max-width: 500px) {
    .header__epigraph {
      display: none;
    }

    .header__title {
      font-size: 1.2em;
    }

    .content h2 {
      font-size: 1.2em;
    }

    .main .header .header__title {
      margin-bottom: 30px;
    }

    .header__feature {
      margin-top: -23px;
    }

    .featured__credit {
      margin-left: -15px;
      margin-right: -15px;
      position: relative;
    }

    .related-posts .header__feature {
      margin-top: 0.5em;
    }

    .profile-inner {
      display: grid;
      grid-template-areas:
        "icon heading"
        "content content";
      grid-template-columns: 40px auto;
      align-items: center;
    }

    .profile__image {
      grid-area: icon;
      justify-self: center;
    }

    .profile__heading {
      grid-area: heading;
      margin-bottom: 0;
      border-bottom: none;
    }

    .profile__content {
      grid-area: content;
      border-top: 1px dashed var(--profile-text-color);
      margin-top: 0.5em;
      padding-top: 0.5em;
    }
  }

  @media screen and (max-width: 730px) {
    .container {
      padding: 0;
      border-radius: 0;
    }

    article {
      border-radius: 0;
      padding: 1em;
    }

    .article-summary {
      padding: 1em;
    }

    .post .writing-vertical {
      margin-left: 0;
      margin-right: 0;
      width: 100%;
    }

    .header__feature img {
      max-width: 100%;
      height: auto;
    }

    .related-posts .content {
      -webkit-line-clamp: 3;
    }

    .profile {
      border-radius: 0;
      margin-top: 3em;
    }

    .main .profile {
      border-radius: var(--border-radius);
    }

    .featured__image,
    .content__image {
      margin: 0 -1em;
    }
  }

  @media screen and (max-width: 985px) {
    .container {
      width: 100%;
    }

    .pagination {
      margin: 0 10px;
    }
  }

  /*
 * a11y theme for JavaScript, CSS, and HTML
 * Based on the okaidia theme: https://github.com/PrismJS/prism/blob/gh-pages/themes/prism-okaidia.css
 * @author ericwbailey
 */

  /*
 * MARK: Setup
 */
  @layer vendor-prism {
    @media (forced-colors: none), (forced-colors: active) {
      :root {
        --prism-a11y-border-radius: 0.3em;
        --prism-a11y-font-family: Consolas, Monaco, "Andale Mono", "Ubuntu Mono",
          monospace;
        --prism-a11y-line-height: 1.5;
        --prism-a11y-code-block-margin: 0.5em 0;
        --prism-a11y-code-block-padding: 1em;
        --prism-a11y-code-inline-padding: 0.1em;
        --prism-a11y-width-border: 1px;
        --prism-a11y-width-tab: 2;
      }
    }

    @media (forced-colors: none), (forced-colors: active) {
      :root {
        --prism-a11y-color-background: hsla(0, 0%, 100%, 1);
        --prism-a11y-color-text-no-token: hsla(0, 0%, 33%, 1);
        --prism-a11y-color-text-comment: hsla(16, 100%, 25%, 1);
        --prism-a11y-color-text-blue: hsla(212, 55.2%, 43.7%, 1);
        --prism-a11y-color-text-cyan: hsla(192, 65.2%, 34.9%, 1);
        --prism-a11y-color-text-green: hsla(120, 100%, 25%, 1);
        --prism-a11y-color-text-gray: hsla(0, 0%, 41%, 1);
        --prism-a11y-color-text-purple: hsla(282, 100%, 41%, 1);
        --prism-a11y-color-text-red: hsla(2, 80%, 47%, 1);
        --prism-a11y-color-text-yellow: hsla(43, 74%, 30%, 1);
        --prism-a11y-plugin-color-border: hsla(43, 74%, 30%, 0.55);
        --prism-a11y-plugin-color-background: hsla(43, 74%, 30%, 0.1);
      }
    }

    @media (forced-colors: none), (forced-colors: active) {
      /*
     * MARK: Theme
     */
      :where(code[class*="language-"], pre[class*="language-"]) {
        color: var(--prism-a11y-color-text-no-token);
        background: var(--prism-a11y-color-background);
        font-family: var(--prism-a11y-font-family);
        text-align: start;
        white-space: pre;
        word-spacing: normal;
        word-break: normal;
        word-wrap: normal;
        line-height: var(--prism-a11y-line-height);

        -moz-tab-size: var(--prism-a11y-width-tab);
        -o-tab-size: var(--prism-a11y-width-tab);
        tab-size: var(--prism-a11y-width-tab);

        -webkit-hyphens: none;
        -moz-hyphens: none;
        -ms-hyphens: none;
        hyphens: none;
      }

      /* Code blocks */
      pre[class*="language-"] {
        padding: var(--prism-a11y-code-block-padding);
        margin: var(--prism-a11y-code-block-margin);
        overflow: auto;
        border-radius: var(--prism-a11y-border-radius);
      }

      :where(:not(pre) > code[class*="language-"], pre[class*="language-"]) {
        background: var(--prism-a11y-color-background);
      }

      /* Inline code */
      :not(pre) > code[class*="language-"] {
        padding: var(--prism-a11y-code-inline-padding);
        border-radius: var(--prism-a11y-border-radius);
        white-space: normal;
      }

      :where(.token.comment, .token.prolog, .token.doctype, .token.cdata) {
        color: var(--prism-a11y-color-text-comment);
      }

      .token.punctuation {
        color: var(--prism-a11y-color-text-gray);
      }

      :where(
          .token.property,
          .token.tag,
          .token.constant,
          .token.symbol,
          .token.deleted
        ) {
        color: var(--prism-a11y-color-text-red);
      }

      :where(
          .token.operator,
          .token.entity,
          .token.url,
          .language-css .token.string,
          .style .token.string,
          .token.variable,
          .token.keyword
        ) {
        color: var(--prism-a11y-color-text-cyan);
      }

      :where(
          .token.selector,
          .token.attr-name,
          .token.string,
          .token.char,
          .token.builtin,
          .token.inserted
        ) {
        color: var(--prism-a11y-color-text-green);
      }

      :where(
          .token.atrule,
          .token.attr-value,
          .token.function,
          .token.regex,
          .token.important
        ) {
        color: var(--prism-a11y-color-text-yellow);
      }

      :where(.token.boolean, .token.number, .token.keyword) {
        color: var(--prism-a11y-color-text-purple);
      }

      :where(.token.important, .token.bold) {
        font-weight: bold;
      }

      .token.italic {
        font-style: italic;
      }

      .token.entity {
        cursor: help;
      }

      /*
     * MARK: Plugin support
     */
      /* Line highlight */
      .line-highlight {
        background: var(--prism-a11y-plugin-color-background);
        border-top: var(--prism-a11y-width-border) solid
          var(--prism-a11y-plugin-color-border);
        border-bottom: var(--prism-a11y-width-border) solid
          var(--prism-a11y-plugin-color-border);
      }

      /* Line numbers */
      .line-numbers .line-numbers-rows {
        border-right: var(--prism-a11y-width-border) solid
          var(--prism-a11y-color-text-no-token);
      }

      .line-numbers-rows > span:before {
        color: var(--prism-a11y-color-text-comment);
      }
    }

    /*
   * MARK: Forced color mode support
   */
    @media (forced-colors: active) {
      :root {
        --prism-a11y-color-background: Canvas;
        --prism-a11y-color-text-no-token: CanvasText;
        --prism-a11y-color-text-comment: GrayText;
        --prism-a11y-color-text-cyan: LinkText;
        --prism-a11y-color-text-gray: LinkText;
        --prism-a11y-color-text-green: CanvasText;
        --prism-a11y-color-text-purple: CanvasText;
        --prism-a11y-color-text-red: CanvasText;
        --prism-a11y-color-text-yellow: GrayText;
        --prism-a11y-plugin-color-border: LinkText;
        --prism-a11y-plugin-color-background: Canvas;
      }

      :where(.token.boolean, .token.number, .token.keyword) {
        font-weight: bold;
      }
    }
  }
</style><link rel="alternate" href="/atom.xml" title="メモログ" type="application/atom+xml"><link rel="alternate" href="https://memolog.org/atom.xml" title="Latest Articles"><link rel="apple-touch-icon" href="/assets/icons/icon-192.png"><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="white"><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@graph": [
      {
        "@context": "http://schema.org",
        "@type": "Organization",
        "url": "http://memolog.org",
        "logo": "https://memolog.org/assets/icons/icon-1024.png"
      },
      {
        "@context": "http://schema.org",
        "@type": "Person",
        "name": "Yutaka Yamaguchi",
        "url": "http://memolog.org",
        "sameAs": [
          "https://www.facebook.com/yutaka.yamaguchi",
          "https://www.linkedin.com/in/yutakayamaguchi/",
          "https://twitter.com/memolog"
        ]
      }
    ]
  }
</script><meta property="og:type" content="article"><meta property="og:title" content="JavaScriptでビットベクタルを使う"><meta property="og:url" content="https://memolog.org/2025/a-crash-course-on-crises.html"><meta property="og:site_name" content="メモログ"><meta property="og:description" content="ビットベクトルは2進数の値（ビット）の配列を使って状態を保持する。ビット配列（bit array）とかbit set, bit stringとも言うらしい。詳しくはBit arrayを参照。"><meta property="og:locale" content="ja_JP"><meta property="og:image" content="/assets/images/miles-storey-142842-unsplash/miles-storey-142842-unsplash.jpg"><meta property="article:published_time" content="2018-07-28T10:49:22.000Z"><meta property="article:author" content="Yutaka Yamaguchi"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://memolog.org/assets/images/miles-storey-142842-unsplash/miles-storey-142842-unsplash.jpg"><meta name="twitter:creator" content="@memolog"><meta name="twitter:site" content="https://twitter.com/memolog"><meta property="fb:app_id" content="168245123786587"><link rel="canonical" href="https://memolog.org/2018/bit-vector-in-javascript.html"></head> <body class="post"> <header class="header header_component_global"> <div class="header-inner"> <div class="header__icon" aria-hidden="true"> <img src="/assets/icons/icon.svg" role="presentation" width="32" height="32" alt="icon" loading="lazy"> </div> <h1 class="header__title"> <a href="/">メモログ</a> </h1> <nav class="navigation navigation-global"> <a href="/" class="navigation__link">
📘 最新のメモ
</a> </nav> </div> </header> <div class="container"> <main class="main"> <article> <header class="header"> <div> <time datetime="2018-07-28T10:49:22.000Z"> <span class="calendar-icon">📅</span> <span>2018年7月28日</span> </time> </div> <h2 class="header__title"><span>JavaScriptでビットベクタルを使う</span></h2> <div class="header__feature" aria-hidden="true"> <div class="featured__image" style="background-color: #5e4431;"> <div style="background-color: #5e4431"> <img src="/assets/images/miles-storey-142842-unsplash/miles-storey-142842-unsplash.svg" alt role="presentation" loading="eager" width="985" height="654"> </div> </div> <div class="featured__credit">Original photo by <a href="https://unsplash.com/photos/X45VKpWV7hw?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText" target="_blank" rel="noopener" tabindex="-1">Miles Storey</a> on <a href="https://unsplash.com/?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText" target="_blank" rel="noopener" tabindex="-1">Unsplash</a>, edited with <a href="https://github.com/fogleman/primitive" target="_blank" rel="noopener" tabindex="-1">Primitive</a></div> </div> </header> <div id="article-content" class="content">  <p>ビットベクトルは 2 進数の値（ビット）の配列を使って状態を保持する。ビット配列（bit array）とか bit set, bit string とも言うらしい。詳しくは<a href="https://en.wikipedia.org/wiki/Bit_array">Bit array</a>を参照。</p>
<p>JavaScript の数値（<a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Number">Number</a>）は 64 ビットの<a href="https://en.wikipedia.org/wiki/Double-precision_floating-point_format">倍精度浮動小数点型数値</a>で表現される。Swift みたいな<a href="https://developer.apple.com/documentation/swift/int">Int</a>と<a href="https://developer.apple.com/documentation/swift/double">Double</a>といった区別はなく、JavaScript の数値はすべて Double として表現される。</p>
<blockquote>
<p>8.5 The Number type
The Number type has exactly 18437736874454810627 (that is, 2^64−2^53+3) values, representing the double-precision 64-bit format IEEE 754 values as specified in the IEEE Standard for Binary Floating-Point Arithmetic, except that the 9007199254740990 (that is, 2^53−2) distinct “Not-a-Number” values of the IEEE Standard are represented in ECMAScript as a single special NaN value. (Note that the NaN value is produced by the program expression NaN, assuming that the globally defined variable NaN has not been altered by program execution.) In some implementations, external code might be able to detect a difference between various Non-a-N
<a href="https://www.ecma-international.org/publications/files/ECMA-ST-ARCH/ECMA-262,%201st%20edition,%20June%201997.pdf">https://www.ecma-international.org/publications/files/ECMA-ST-ARCH/ECMA-262,%201st%20edition,%20June%201997.pdf</a></p>
</blockquote>
<p><a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Operators/Bitwise_Operators">ビット演算子</a> は数値をビットとして操作するための演算子。ビット演算子では数値を 32 ビットのビットの並びとして扱う。</p>
<blockquote>
<p>ビット演算子は、オペランドとして整数値が必要です。また、この整数値は、64 ビットの浮動小数点表現形式ではなく、32 ビット整数表現形式で表されているものとして処理を行います。これらの演算子は、必要であればオペランドを数値に変換し、オペランドの小数点部分を削除したり、33 ビット目以上のビットを捨てたりすることで、32 ビットの整数表現で表せるようにします。
<a href="https://www.oreilly.co.jp/books/9784873115733/">JavaScript 第 6 版</a> 73 ページ</p>
</blockquote>
<p>特定のビットを 1（True）にセットする場合は下記のような感じのことをする。</p>
<pre class="language-javascript" data-language="javascript"><code is:raw="" class="language-javascript"><span class="token keyword">let</span> bits <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
bits <span class="token operator">=</span> bits <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&#x3C;&#x3C;</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><code>a &#x3C;&#x3C; b</code>は a を b ビット分だけ左にシフトして、右側に 0 を埋める。<code>1 &#x3C;&#x3C; 2</code>だと、<code>00000000000000000000000000000001</code>というビットの並びを <code>00000000000000000000000000000100</code>とする感じ。<code>a | b</code>は a か b のどちらかのビットが 1 だったら 1 にするので、<code>0 | (1 &#x3C;&#x3C; 2)</code>の場合、<code>00000000000000000000000000000000 | 00000000000000000000000000000100</code>となるので、<code>00000000000000000000000000000100</code>というビットの並びが返ってくる。右から 3 つ目のビットだけ True に設定できる。</p>
<p>特定のビットを 0（False）にセットする場合は下記のような感じになる。</p>
<pre class="language-javascript" data-language="javascript"><code is:raw="" class="language-javascript">bits <span class="token operator">=</span> bits <span class="token operator">&#x26;</span> <span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&#x3C;&#x3C;</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><code>~</code>は各ビットを反転させるので、<code>~(1 &#x3C;&#x3C; 2)</code>の返りは<code>11111111111111111111111111111011</code>となる。<code>a &#x26; b</code>は a と b の両方のビットがどちらも 1 の場合は 1 を返す。例えば<code>bits</code>の値が<code>00010000000000000000000000100101</code>だとしたら、<code>bits &#x26; ~(1 &#x3C;&#x3C; 2)</code>のは <code>00010000000000000000000000100101 &#x26; 11111111111111111111111111111011</code>となるので、<code>00010000000000000000000000100001</code>というビットの並びが返ってくる。右から 3 つ目のビットだけを 0 に変更できる。</p>
<p>特定のビットが 1（True）かどうかを確認するのには、下記のような感じになる。</p>
<pre class="language-javascript" data-language="javascript"><code is:raw="" class="language-javascript"><span class="token keyword">return</span> bits <span class="token operator">&#x26;</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&#x3C;&#x3C;</span> <span class="token number">2</span> <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>例えば bits の値が<code>00010000000000000000000000100101</code>としたら、<code>bits &#x26; (1 &#x3C;&#x3C; 2)</code>は<code>00010000000000000000000000100101 &#x26; 00000000000000000000000000000100</code> となるので返りは<code>00000000000000000000000000000100</code>となる。これは 10 進数でいうと<code>4</code>になるので、<code>4 !== 0</code>ということで True になる。bits の値が<code>00010000000000000000000000100001</code>としたら、返りは<code>00000000000000000000000000000000</code>となるので <code>0 !== 0</code> ということで False となる。</p>
<p>1 つの数値は 32 個のビットの並びになるので、32 個の True/False の値を保持できる。たとえば特定のアルファベット（大文字小文字区別しない）が使われたかどうかを確認するとしたら、</p>
<pre class="language-javascript" data-language="javascript"><code is:raw="" class="language-javascript"><span class="token keyword">let</span> bits <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">checkThisAlphabetIsAlreadyUsed</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">char</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> index <span class="token operator">=</span> char<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">97</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>bits <span class="token operator">&#x26;</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&#x3C;&#x3C;</span> index<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  bits <span class="token operator">=</span> bits <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&#x3C;&#x3C;</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">useAlphabetOnlyOnce</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">char</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">checkThisAlphabetIsAlreadyUsed</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">'</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>char<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">' is already in use</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Use </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>char<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>みたいな感じで、各アルファベットが使われたどうかを 1 から 26 個目までのビットに格納する。</p>
<pre class="language-javascript" data-language="javascript"><code is:raw="" class="language-javascript"><span class="token operator">></span> <span class="token function">useAlphabetOnlyOnce</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Use a
<span class="token operator">></span> <span class="token function">useAlphabetOnlyOnce</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token literal-property property">Error</span><span class="token operator">:</span> <span class="token string">'a'</span> is already <span class="token keyword">in</span> use
    at <span class="token function">useAlphabetOnlyOnce</span> <span class="token punctuation">(</span>repl<span class="token operator">:</span><span class="token number">3</span><span class="token operator">:</span><span class="token number">11</span><span class="token punctuation">)</span>
<span class="token operator">></span> <span class="token function">useAlphabetOnlyOnce</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Use b
</code></pre>
<p>32 個以上の値を保持したい場合は、<code>bits</code>を配列にして数値を複数扱うようにすれば良い。<a href="https://github.com/ashaffer/bit-vector">bit-vector</a>ではそのようにして 32 個以上の値を保持できるようにしている。<a href="https://github.com/ashaffer/bit-vector/blob/master/src/index.js">index.js</a>を見ると、設定する index を 32 で割って、配列の index と、数値の 32 ビットの位置とを分けている。</p>
<p><a href="https://jsperf.com/bit-vector-vs-object/2">js-perf の結果</a>を見ると、普通のオブジェクトに値を保持するよりもだいぶ高速に処理できている。</p>
<p>これは蛇足だけど、bit-vector では<code>FastArray</code>ということで、</p>
<pre class="language-javascript" data-language="javascript"><code is:raw="" class="language-javascript"><span class="token keyword">const</span> FastArray <span class="token operator">=</span> <span class="token keyword">typeof</span> Uint32Array <span class="token operator">===</span> <span class="token string">"undefined"</span> <span class="token operator">?</span> Array <span class="token operator">:</span> Uint32Array<span class="token punctuation">;</span>
</code></pre>
<p>と言う感じで、Uint32Array が利用可能な場合は<a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Uint32Array">Uint32Array</a>を使用している。Uint32Array のような<a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/TypedArray">TypedArray</a>は、通常の配列（standard array）に比べると高速らしいのだが、実際に測定してみると同じくらいの速度になる(<a href="https://stackoverflow.com/a/24855023/634197">Javascript TypedArray performance</a>)。これは JavaScript のエンジンが内部で最適化していて、通常の配列でも利用可能な場合は同じように<code>true array</code>を使い、使えない場合は<code>old-fashioned property map "arrays,"</code>を使うためらしい。</p>
<blockquote>
<p>That suggests that because you’re filling the array in a simple, predictable way, a modern engine continues to use a true array (with the performance benefits thereof) under the covers rather than shifting over. We see basically the same performance for both. The difference in speed could relate to type conversion taking the Uint32 value and assigning it to sum as a number (though I’m surprised if that type conversion isn’t deferred…).
…(snip)…
…so that the engine has to fall back on old-fashioned property map “arrays,” and you see that typed arrays markedly outperform the old-fashioned kind
<a href="https://stackoverflow.com/a/24855023/634197">Javascript TypedArray performance</a></p>
</blockquote>
<p>いずれにしてもビットベクトルように明らかに 32 ビットまでの数値だけを扱っている配列の場合は、明確に Uint32Array を使った方が良いなと思う。</p>
<p>というメモ。</p>  </div> <footer class="profile"> <div class="profile-inner"> <div class="profile__image"> <img src="/assets/icons/icon.svg" role="presentation" width="48" height="48" alt=""> </div> <h2 class="profile__heading">私について</h2> <div class="profile__content"> <div>Yutaka Yamaguchi</div> <div>
東京在住。TypeScript, Node.js,
        Reactなどフロンエンドが主力。Perlも書く。SwiftやRubyも過去には使ってた。過去のTOEIC
        860くらい。
</div> <ul class="profile__social-list"> <li class="profile__social-list-item"> <a href="https://twitter.com/memolog">X</a> </li> <li class="profile__social-list-item"> <a href="https://www.linkedin.com/in/yutakayamaguchi/">LinkedIn</a> </li> </ul> </div> </div> </footer> </article> </main> <aside class="related-posts"> <h2 class="header__title">📖 関連メモ</h2> <div> <article class="article-summary"> <header class="header"> <div> <time datetime="2014-03-02T20:50:00.000Z"> <span class="calendar-icon">📅</span> <span>2014年3月3日</span> </time> </div> <h3 class="header__title article__title"> <a href="/2014/03/ngbindhtml_and_surrogate_pair.html">ngBindHtmlとサロゲートペア</a> </h3>  </header> <div class="content">AngularJSでngBindHtmlを使用すると、ngSanitize(angular-sanitize.js)のencodeEntitiesに行き着く（はず）。そこでは下記のような処理が行われています。</div> <div class="read-more"> <a href="/2014/03/ngbindhtml_and_surrogate_pair.html">📖 続きを読む</a> </div> </article><article class="article-summary"> <header class="header"> <div> <time datetime="2025-04-10T23:15:00.000Z"> <span class="calendar-icon">📅</span> <span>2025年4月11日</span> </time> </div> <h3 class="header__title article__title"> <a href="/2025/generate-related-posts.html">記事に関連メモを出してみる</a> </h3> <div class="header__feature" aria-hidden="true"> <div class="featured__image" style="background-color: #c2bbad;"> <img src="/assets/images/generate-related-posts/generate-related-posts_medium.webp" srcset="/assets/images/generate-related-posts/generate-related-posts_medium.webp, /assets/images/generate-related-posts/generate-related-posts_medium@2x.webp 2x" role="presentation" loading="lazy" width="985" height="328" alt> </div> <div class="featured__credit">Image by <a href="https://chatgpt.com/" target="_blank" rel="noopener" tabindex="-1">ChatGPT</a></div> </div> </header> <div class="content">記事データをベクトル化して、関連記事（メモ）を表示できるか試してみた、というメモ。</div> <div class="read-more"> <a href="/2025/generate-related-posts.html">📖 続きを読む</a> </div> </article><article class="article-summary"> <header class="header"> <div> <time datetime="2020-02-25T06:48:00.000Z"> <span class="calendar-icon">📅</span> <span>2020年2月25日</span> </time> </div> <h3 class="header__title article__title"> <a href="/2020/css-property-conventions.html">CSS property conventions</a> </h3> <div class="header__feature" aria-hidden="true"> <div class="featured__image" style="background-color: #342f2d;"> <div style="background-color: #342f2d"> <img src="/assets/images/delaney-van-EUVN4bihZug-unsplash/delaney-van-EUVN4bihZug-unsplash.svg" alt role="presentation" loading="lazy" width="985" height="654"> </div> </div> <div class="featured__credit">Original photo by <a href="https://unsplash.com/@delaneyvan?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText" target="_blank" rel="noopener" tabindex="-1">Delaney Van</a> on <a href="https://unsplash.com/?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText" target="_blank" rel="noopener" tabindex="-1">Unsplash</a>, edited with <a href="https://github.com/fogleman/primitive" target="_blank" rel="noopener" tabindex="-1">Primitive</a></div> </div> </header> <div class="content">前回のThe display property definition in CSS2に引き続き。1.2. Valuesに、プロパティの仕様については1.4.2 CSS property definitionsの表記に従うと書いてあるので、そのあたりを確認していく。</div> <div class="read-more"> <a href="/2020/css-property-conventions.html">📖 続きを読む</a> </div> </article><article class="article-summary"> <header class="header"> <div> <time datetime="2011-09-11T13:36:00.000Z"> <span class="calendar-icon">📅</span> <span>2011年9月11日</span> </time> </div> <h3 class="header__title article__title"> <a href="/2011/09/diff-image-with-watir-webdriver.html">watir-webdriver で画像データを評価する</a> </h3>  </header> <div class="content">たとえば、画像ファイルが上書きされているかどうかを確認したい場合などで、画像のsrcなどには差分がなく画像データを比較しないとその動作の正否が分からないとか、そういうときはやはり画像データを評価して差を見るしかない。</div> <div class="read-more"> <a href="/2011/09/diff-image-with-watir-webdriver.html">📖 続きを読む</a> </div> </article> </div> </aside> </div> </body></html>