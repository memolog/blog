<!DOCTYPE html><html lang="ja"> <head><title>JavaScriptでハッシュテーブルを作る | メモログ</title><meta name="description" content="塵が積もって山とならないメモのログ" id="meta-description"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="shortcut icon" href="/assets/icons/icon-32.ico"><style>
  :root {
    --container-width: 985px;
    --link-color: #694b16;
    --background-color: #e3ded5;
    --lighter-color: #fdf8ee;
    --darker-color: #cac5bc;
    --more-dark-color: #b1aca4;
    --border-color: #cac5bc;
    --profile-text-color: #55514a;
    --article-background-color: white;
    --profile-background-color: var(--border-color);
    --border-radius: 10px;
    --pagination-item-width: 61px;
    --featured-caption-color: #534f48;
  }

  * {
    box-sizing: border-box;
  }

  body {
    background-color: var(--background-color);
    color: black;
    font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue",
      "Hiragino Kaku Gothic Pro", YuGothic, "Yu Gothic", Meiryo, sans-serif;
    margin: 0;
    padding: 0;
  }

  a {
    color: var(--link-color);
  }

  .header {
    margin: 0 auto;
    font-family: Garamond, "Times New Roman", serif;
  }

  .header:has(.featured__image) {
    margin-bottom: 2em;
  }

  .header_component_global {
    width: 100%;
  }

  .header-inner {
    text-align: center;
    margin: 5px auto;
    max-width: var(--container-width);
    display: grid;
    grid-template-columns: 36px 96px auto;
    align-items: center;
  }

  .header__icon {
    justify-self: end;
  }

  .header__title {
    margin: 0.2em 0 0.2em;
    font-size: 1.8em;
    font-weight: normal;
    vertical-align: bottom;
  }

  .header__title a,
  .header__title > span {
    color: black;
    text-decoration: none;
  }

  .header_component_global .header__title {
    font-family: sans-serif;
    font-size: 14px;
    line-height: 16px;
    font-weight: bold;
    justify-self: start;
  }

  .header_component_global .header__title a {
    text-decoration: none;
    color: black;
    padding: 7px 5px;
    background-color: transparent;
  }

  .header_component_global .navigation-global {
    justify-self: end;
    padding-right: 10px;
    font-family: sans-serif;
  }

  .header__description {
    margin-top: 0;
    margin-bottom: 1em;
  }

  .header_component_global .header__description {
    color: #666;
    margin: 0 auto;
    padding: 0 5px;
  }

  .header__epigraph {
    font-style: italic;
    color: #666;
    margin: 0 auto;
    padding: 5px;
  }

  .container {
    width: var(--container-width);
    max-width: 100%;
    margin: 0 auto 4em;
    padding: 0;
    border-radius: var(--border-radius);
  }

  article {
    background-color: var(--article-background-color);
    padding: 2em;
    border-radius: var(--border-radius);
  }

  .content {
    font-size: 1.125em;
    line-height: 2em;
    background: var(--article-background-color);
    color: #222;
    -webkit-font-smoothing: antialiased;
  }

  .read-more {
    margin-top: 1em;
  }

  .content h2,
  .content h3 {
    font-size: 1.4em;
    margin: 2em 0 1em 0;
    border-bottom: 1px solid #ddd;
  }

  .article-summary {
    margin-bottom: 3.5em;
  }

  .header time {
    display: inline-block;
    font-size: 0.8125em;
    color: #666;
    font-family: sans-serif;
  }

  .calendar-icon,
  .author-icon {
    margin-right: 0.5em;
  }

  .content blockquote {
    border: 5px solid var(--border-color);
    background: var(--lighter-color);
    margin: 1.5em 0;
    padding: 0 1em;
    border-radius: var(--border-radius);
  }

  .content p > code,
  .content li > code {
    background-color: #f5f2f0;
    display: inline-block;
    padding: 0 6px;
    border-radius: var(--border-radius);
    color: #444;
  }

  .content table {
    background: #e0e0e0;
  }

  .content th {
    background: #f0f0f0;
  }

  .content tr {
    background: #fff;
  }

  .content tr:nth-child(even) {
    background: #f0f0f0;
  }

  .content td {
    padding: 5px 1em;
    text-align: center;
  }

  .header__feature {
    margin: 0.5em 0 -0.5em;
    position: relative;
  }

  .header__feature img {
    overflow: hidden;
  }

  .featured__image {
    background: #f5f2f0;
    line-height: 0;
    overflow: hidden;
    margin: 0 -32px;
  }

  .featured__image picture {
    display: block;
    height: auto;
    width: 100%;
  }

  .featured__image img {
    width: 100%;
    object-fit: cover;
    height: auto;
    aspect-ratio: 3 / 1;
  }

  .featured__credit {
    color: #333;
    font-size: 0.825em;
    text-align: right;
    position: absolute;
    right: 0;
    bottom: 0;
    padding: 7px;
    background: #f0f0f0;
    opacity: 0.8;
  }

  .featured__credit a {
    color: #333;
  }

  .lazyload,
  .lazyloading {
    opacity: 0.5;
  }

  .lazyloaded {
    opacity: 1;
    transition: opacity 2s 0.3s cubic-bezier(0.3, 0.18, 0.15, 1);
  }

  .content img {
    max-width: 100%;
  }

  .content img.screenshot {
    display: block;
    height: auto;
    max-width: 100%;
    object-fit: contain;
    border: 4px solid var(--border-color);
    border-radius: var(--border-radius);
  }

  .youtube-wrapper {
    position: relative;
    display: block;
    height: 0;
    padding: 0;
    overflow: hidden;
    padding-bottom: 56.25%;
  }

  .youtube-wrapper iframe {
    position: absolute;
    top: 0;
    left: 0;
    bottom: 0;
    height: 100%;
    width: 100%;
    border: 0;
  }

  .related-posts > div {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(355px, 1fr));
    gap: 20px;
  }

  .related-posts h2 {
    font-size: 1em;
    font-weight: normal;
    margin: 2.5em 0 0.5em 0.5em;
    color: var(--profile-text-color);
  }

  .related-posts article {
    padding: 20px 15px;
    margin-bottom: 0;
  }

  .related-posts article .header:has(.featured__image) {
    margin-bottom: 1em;
  }

  .related-posts .article__title {
    font-size: 1.2em;
  }

  .related-posts .content {
    font-size: 1em;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 3;
    overflow: hidden;
  }

  .related-posts .featured__image {
    margin-left: -15px;
    margin-right: -15px;
  }

  .related-posts .featured__credit {
    display: none;
  }

  .profile {
    border: 1px solid var(--profile-background-color);
    padding: 1em;
    margin-top: 2em;
    color: var(--profile-text-color);
    border-radius: var(--border-radius);
    background: var(--profile-background-color);
  }

  .profile__heading {
    margin-bottom: 0.3em;
    margin-top: 0;
    border-bottom: 1px dashed var(--profile-text-color);
    display: inline-block;
    font-weight: bold;
    font-family: Garamond, "Times New Roman", serif;
  }

  .profile__image {
    float: left;
    margin-right: 6px;
  }

  .profile__content {
    overflow: hidden;
    font-family: sans-serif;
    line-height: 1.5em;
  }

  .navigation__link,
  .profile__content a {
    color: var(--profile-text-color);
  }

  .profile__social-list {
    margin: 0.5em 0 0 0;
    padding: 0;
    list-style-type: none;
  }

  .profile__social-list-item {
    display: inline;
    margin-right: 0.5em;
  }

  .content hr {
    border-top-width: 0;
    border-bottom-width: 1;
    border-style: solid;
    border-color: #ddd;
    margin-top: 4em;
  }

  .pagination {
    display: grid;
    grid-template-columns: repeat(auto-fit, var(--pagination-item-width));
    gap: 10px;
    align-items: center;
    justify-items: center;
    justify-content: center;
    margin: 0;
  }

  .page-number,
  .extend.next,
  .extend.prev,
  .pagination .space {
    width: 100%;
    text-align: center;
    line-height: var(--pagination-item-width);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    background: var(--background-color);
  }

  .pagination .space {
    border-color: transparent;
  }

  .page-number.current {
    background: var(--darker-color);
    font-weight: bold;
    color: white;
    border-color: var(--darker-color);
  }

  .post .writing-vertical {
    writing-mode: vertical-rl;
    font-family: serif;
    font-size: 1em;
    margin: 1.5em 0;
    column-count: 2;
    max-width: var(--container-width);
    width: 102%;
    overflow: auto;
    height: 800px;
  }

  .post .writing-vertical p {
    margin: 0;
  }

  .post .writing-vertical p:first-letter {
    margin-top: 1em;
  }

  .post .writing-vertical .link-icon {
    background-position-x: center;
    background-position-y: 5px;
  }

  .post .writing-vertical blockquote {
    border: none;
    margin: 0 0.5em;
    padding: 1em 0.5em;
    background: #f0f0f0;
  }

  pre[class*="language-"] {
    border: 4px solid var(--border-color);
    font-size: 16px;
    border-radius: var(--border-radius);
  }

  @media screen and (max-width: 500px) {
    .header__epigraph {
      display: none;
    }

    .header__title {
      font-size: 1.2em;
    }

    .content h2 {
      font-size: 1.2em;
    }

    .main .header .header__title {
      margin-bottom: 30px;
    }

    .header__feature {
      margin-top: -23px;
    }

    .featured__credit {
      margin-left: -15px;
      margin-right: -15px;
      position: relative;
    }

    .related-posts .header__feature {
      margin-top: 0.5em;
    }

    .profile-inner {
      display: grid;
      grid-template-areas:
        "icon heading"
        "content content";
      grid-template-columns: 40px auto;
      align-items: center;
    }

    .profile__image {
      grid-area: icon;
      justify-self: center;
    }

    .profile__heading {
      grid-area: heading;
      margin-bottom: 0;
      border-bottom: none;
    }

    .profile__content {
      grid-area: content;
      border-top: 1px dashed var(--profile-text-color);
      margin-top: 0.5em;
      padding-top: 0.5em;
    }
  }

  @media screen and (max-width: 730px) {
    .container {
      padding: 0;
      border-radius: 0;
    }

    article {
      border-radius: 0;
      padding: 1em;
    }

    .article-summary {
      padding: 1em;
    }

    .post .writing-vertical {
      margin-left: 0;
      margin-right: 0;
      width: 100%;
    }

    .header__feature img {
      max-width: 100%;
      height: auto;
    }

    .related-posts .content {
      -webkit-line-clamp: 3;
    }

    .profile {
      border-radius: 0;
      margin-top: 3em;
    }

    .main .profile {
      border-radius: var(--border-radius);
    }

    .featured__image,
    .content__image {
      margin: 0 -1em;
    }
  }

  @media screen and (max-width: 985px) {
    .container {
      width: 100%;
    }

    .pagination {
      margin: 0 10px;
    }
  }

  /*
 * a11y theme for JavaScript, CSS, and HTML
 * Based on the okaidia theme: https://github.com/PrismJS/prism/blob/gh-pages/themes/prism-okaidia.css
 * @author ericwbailey
 */

  /*
 * MARK: Setup
 */
  @layer vendor-prism {
    @media (forced-colors: none), (forced-colors: active) {
      :root {
        --prism-a11y-border-radius: 0.3em;
        --prism-a11y-font-family: Consolas, Monaco, "Andale Mono", "Ubuntu Mono",
          monospace;
        --prism-a11y-line-height: 1.5;
        --prism-a11y-code-block-margin: 0.5em 0;
        --prism-a11y-code-block-padding: 1em;
        --prism-a11y-code-inline-padding: 0.1em;
        --prism-a11y-width-border: 1px;
        --prism-a11y-width-tab: 2;
      }
    }

    @media (forced-colors: none), (forced-colors: active) {
      :root {
        --prism-a11y-color-background: hsla(0, 0%, 100%, 1);
        --prism-a11y-color-text-no-token: hsla(0, 0%, 33%, 1);
        --prism-a11y-color-text-comment: hsla(16, 100%, 25%, 1);
        --prism-a11y-color-text-blue: hsla(212, 55.2%, 43.7%, 1);
        --prism-a11y-color-text-cyan: hsla(192, 65.2%, 34.9%, 1);
        --prism-a11y-color-text-green: hsla(120, 100%, 25%, 1);
        --prism-a11y-color-text-gray: hsla(0, 0%, 41%, 1);
        --prism-a11y-color-text-purple: hsla(282, 100%, 41%, 1);
        --prism-a11y-color-text-red: hsla(2, 80%, 47%, 1);
        --prism-a11y-color-text-yellow: hsla(43, 74%, 30%, 1);
        --prism-a11y-plugin-color-border: hsla(43, 74%, 30%, 0.55);
        --prism-a11y-plugin-color-background: hsla(43, 74%, 30%, 0.1);
      }
    }

    @media (forced-colors: none), (forced-colors: active) {
      /*
     * MARK: Theme
     */
      :where(code[class*="language-"], pre[class*="language-"]) {
        color: var(--prism-a11y-color-text-no-token);
        background: var(--prism-a11y-color-background);
        font-family: var(--prism-a11y-font-family);
        text-align: start;
        white-space: pre;
        word-spacing: normal;
        word-break: normal;
        word-wrap: normal;
        line-height: var(--prism-a11y-line-height);

        -moz-tab-size: var(--prism-a11y-width-tab);
        -o-tab-size: var(--prism-a11y-width-tab);
        tab-size: var(--prism-a11y-width-tab);

        -webkit-hyphens: none;
        -moz-hyphens: none;
        -ms-hyphens: none;
        hyphens: none;
      }

      /* Code blocks */
      pre[class*="language-"] {
        padding: var(--prism-a11y-code-block-padding);
        margin: var(--prism-a11y-code-block-margin);
        overflow: auto;
        border-radius: var(--prism-a11y-border-radius);
      }

      :where(:not(pre) > code[class*="language-"], pre[class*="language-"]) {
        background: var(--prism-a11y-color-background);
      }

      /* Inline code */
      :not(pre) > code[class*="language-"] {
        padding: var(--prism-a11y-code-inline-padding);
        border-radius: var(--prism-a11y-border-radius);
        white-space: normal;
      }

      :where(.token.comment, .token.prolog, .token.doctype, .token.cdata) {
        color: var(--prism-a11y-color-text-comment);
      }

      .token.punctuation {
        color: var(--prism-a11y-color-text-gray);
      }

      :where(
          .token.property,
          .token.tag,
          .token.constant,
          .token.symbol,
          .token.deleted
        ) {
        color: var(--prism-a11y-color-text-red);
      }

      :where(
          .token.operator,
          .token.entity,
          .token.url,
          .language-css .token.string,
          .style .token.string,
          .token.variable,
          .token.keyword
        ) {
        color: var(--prism-a11y-color-text-cyan);
      }

      :where(
          .token.selector,
          .token.attr-name,
          .token.string,
          .token.char,
          .token.builtin,
          .token.inserted
        ) {
        color: var(--prism-a11y-color-text-green);
      }

      :where(
          .token.atrule,
          .token.attr-value,
          .token.function,
          .token.regex,
          .token.important
        ) {
        color: var(--prism-a11y-color-text-yellow);
      }

      :where(.token.boolean, .token.number, .token.keyword) {
        color: var(--prism-a11y-color-text-purple);
      }

      :where(.token.important, .token.bold) {
        font-weight: bold;
      }

      .token.italic {
        font-style: italic;
      }

      .token.entity {
        cursor: help;
      }

      /*
     * MARK: Plugin support
     */
      /* Line highlight */
      .line-highlight {
        background: var(--prism-a11y-plugin-color-background);
        border-top: var(--prism-a11y-width-border) solid
          var(--prism-a11y-plugin-color-border);
        border-bottom: var(--prism-a11y-width-border) solid
          var(--prism-a11y-plugin-color-border);
      }

      /* Line numbers */
      .line-numbers .line-numbers-rows {
        border-right: var(--prism-a11y-width-border) solid
          var(--prism-a11y-color-text-no-token);
      }

      .line-numbers-rows > span:before {
        color: var(--prism-a11y-color-text-comment);
      }
    }

    /*
   * MARK: Forced color mode support
   */
    @media (forced-colors: active) {
      :root {
        --prism-a11y-color-background: Canvas;
        --prism-a11y-color-text-no-token: CanvasText;
        --prism-a11y-color-text-comment: GrayText;
        --prism-a11y-color-text-cyan: LinkText;
        --prism-a11y-color-text-gray: LinkText;
        --prism-a11y-color-text-green: CanvasText;
        --prism-a11y-color-text-purple: CanvasText;
        --prism-a11y-color-text-red: CanvasText;
        --prism-a11y-color-text-yellow: GrayText;
        --prism-a11y-plugin-color-border: LinkText;
        --prism-a11y-plugin-color-background: Canvas;
      }

      :where(.token.boolean, .token.number, .token.keyword) {
        font-weight: bold;
      }
    }
  }
</style><link rel="alternate" href="/atom.xml" title="メモログ" type="application/atom+xml"><link rel="alternate" href="https://memolog.org/atom.xml" title="Latest Articles"><link rel="apple-touch-icon" href="/assets/icons/icon-192.png"><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="white"><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@graph": [
      {
        "@context": "http://schema.org",
        "@type": "Organization",
        "url": "http://memolog.org",
        "logo": "https://memolog.org/assets/icons/icon-1024.png"
      },
      {
        "@context": "http://schema.org",
        "@type": "Person",
        "name": "Yutaka Yamaguchi",
        "url": "http://memolog.org",
        "sameAs": [
          "https://www.facebook.com/yutaka.yamaguchi",
          "https://www.linkedin.com/in/yutakayamaguchi/",
          "https://twitter.com/memolog"
        ]
      }
    ]
  }
</script><meta property="og:type" content="article"><meta property="og:title" content="JavaScriptでハッシュテーブルを作る"><meta property="og:url" content="https://memolog.org/2025/a-crash-course-on-crises.html"><meta property="og:site_name" content="メモログ"><meta property="og:description" content="JavaScriptオブジェクトのプロパティアクセスにおけるビッグ・オーで書いたようにJavaScriptのオブジェクトは基本ハッシュテーブルであるし、Mapオブジェクトも中の実装はChromeではハッシュテーブルであると書かれてある(Optimizing hash tables: hiding the hash code)。だからJavaScriptで自前のハッシュテーブルを作るというのは必要のないことなのだけど試しに作ってみたかった。"><meta property="og:locale" content="ja_JP"><meta property="og:image" content="/assets/images/jan-laugesen-186574-unsplash/jan-laugesen-186574-unsplash.jpg"><meta property="article:published_time" content="2018-07-26T06:31:02.000Z"><meta property="article:author" content="Yutaka Yamaguchi"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://memolog.org/assets/images/jan-laugesen-186574-unsplash/jan-laugesen-186574-unsplash.jpg"><meta name="twitter:creator" content="@memolog"><meta name="twitter:site" content="https://twitter.com/memolog"><meta property="fb:app_id" content="168245123786587"><link rel="canonical" href="https://memolog.org/2018/create-hash-table-in-javascript.html"></head> <body class="post"> <header class="header header_component_global"> <div class="header-inner"> <div class="header__icon" aria-hidden="true"> <img src="/assets/icons/icon.svg" role="presentation" width="32" height="32" alt="icon" loading="lazy"> </div> <h1 class="header__title"> <a href="/">メモログ</a> </h1> <nav class="navigation navigation-global"> <a href="/" class="navigation__link">
📘 最新のメモ
</a> </nav> </div> </header> <div class="container"> <main class="main"> <article> <header class="header"> <div> <time datetime="2018-07-26T06:31:02.000Z"> <span class="calendar-icon">📅</span> <span>2018年7月26日</span> </time> </div> <h2 class="header__title"><span>JavaScriptでハッシュテーブルを作る</span></h2> <div class="header__feature" aria-hidden="true"> <div class="featured__image" style="background-color: #54594c;"> <div style="background-color: #54594c"> <img src="/assets/images/jan-laugesen-186574-unsplash/jan-laugesen-186574-unsplash.svg" alt role="presentation" loading="eager" width="985" height="654"> </div> </div> <div class="featured__credit">Original photo by <a href="https://unsplash.com/photos/4UbSaPKGRqc?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText" target="_blank" rel="noopener" tabindex="-1">Jan Laugesen</a> on <a href="https://unsplash.com/?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText" target="_blank" rel="noopener" tabindex="-1">Unsplash</a>, edited with <a href="https://github.com/fogleman/primitive" target="_blank" rel="noopener" tabindex="-1">Primitive</a></div> </div> </header> <div id="article-content" class="content">  <p><a href="https://memolog.org/2018/javascript-property-access-big-o.html">JavaScript オブジェクトのプロパティアクセスにおけるビッグ・オー</a>で書いたように JavaScript のオブジェクトは基本ハッシュテーブルであるし、<a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Map">Map</a>オブジェクトも中の実装は Chrome ではハッシュテーブルであると書かれてある(<a href="https://v8project.blogspot.com/2018/01/hash-code.html">Optimizing hash tables: hiding the hash code</a>)。だから JavaScript で自前のハッシュテーブルを作るというのは必要のないことなのだけど試しに作ってみたかった。</p>
<pre class="language-javascript" data-language="javascript"><code is:raw="" class="language-javascript"><span class="token keyword">const</span> stringHash <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"string-hash"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">MyHashTable</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">numberOfBucket</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>numberOfBucket <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>numberOfBucket<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hashTable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>numberOfBucket<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    key <span class="token operator">=</span> <span class="token string">""</span> <span class="token operator">+</span> key<span class="token punctuation">;</span>
    <span class="token keyword">const</span> hashTableIndex <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getHashTableIndex</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> bucket <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hashTable<span class="token punctuation">[</span>hashTableIndex<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> bucketLength <span class="token operator">=</span> bucket<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&#x3C;</span> bucketLength<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> data <span class="token operator">=</span> bucket<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    key <span class="token operator">=</span> <span class="token string">""</span> <span class="token operator">+</span> key<span class="token punctuation">;</span>
    <span class="token keyword">const</span> hashTableIndex <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getHashTableIndex</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>hashTable<span class="token punctuation">[</span>hashTableIndex<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>hashTable<span class="token punctuation">[</span>hashTableIndex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hashTable<span class="token punctuation">[</span>hashTableIndex<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">getHashTableIndex</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> hash <span class="token operator">=</span> <span class="token function">stringHash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> hash <span class="token operator">%</span> <span class="token keyword">this</span><span class="token punctuation">.</span>numberOfBucket<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>実装は<a href="https://medium.freecodecamp.org/how-to-implement-a-simple-hash-table-in-javascript-cb3b9c1f2997">How to implement a simple hash table in JavaScript – freeCodeCamp</a>や<a href="http://www.mattzeunert.com/2017/02/01/implementing-a-hash-table-in-javascript.html">Implementing a hash table in JavaScript</a>を参考にしている。</p>
<p><a href="https://github.com/darkskyapp/string-hash">string-hash</a>は、与えられた文字列を 0 から 4294967295 の数値にして返してくれる。</p>
<p>ハッシュテーブルのサイズは、ハッシュ関数の処理やコンフリクトしたときの対応方法によるらしいのだけど、とりあえずインスタンス作成時に設定するようにして、ハッシュテーブルに入れるデータ数に 1.3 をかけた値より大きな素数を使うようにした。素数については<a href="https://primes.utm.edu/nthprime/index.php#nth">The Prime Database: The Nth Prime Page</a>を使って出した。</p>
<blockquote>
<p>But a good general “rule of thumb” is:
The hash table should be an array with length about 1.3 times the maximum number of keys that will actually be in the table, and
Size of hash table array should be a prime number
<a href="http://cseweb.ucsd.edu/~kube/cls/100/Lectures/lec16/lec16-8.html#pgfId-975583">http://cseweb.ucsd.edu/~kube/cls/100/Lectures/lec16/lec16-8.html#pgfId-975583</a></p>
</blockquote>
<p>下記のような感じで簡単に測定してみた。</p>
<pre class="language-javascript" data-language="javascript"><code is:raw="" class="language-javascript"><span class="token keyword">const</span> dataLength <span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> numberOfBucket <span class="token operator">=</span> <span class="token number">13003</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> MyHashTable <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./my-hash-table"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> myHashTable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyHashTable</span><span class="token punctuation">(</span>numberOfBucket<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">"set"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> key<span class="token punctuation">,</span> value<span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&#x3C;</span> dataLength<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  key <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> dataLength<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  value <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> dataLength<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  myHashTable<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">"set"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">"get"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
myHashTable<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">"get"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>結果が 10000 件の追加に<code>19.117ms</code>で取得に<code>0.067ms</code>。</p>
<p>データを以下のように変更して再度実行</p>
<pre class="language-javascript" data-language="javascript"><code is:raw="" class="language-javascript"><span class="token keyword">const</span> dataLength <span class="token operator">=</span> <span class="token number">100000</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> numberOfBucket <span class="token operator">=</span> <span class="token number">130003</span><span class="token punctuation">;</span>
</code></pre>
<p>結果が 100000 件の追加に<code>112.608ms</code>で取得が<code>0.061ms</code>。</p>
<p>データを 1000000 件にすると追加に<code>1592.088ms</code>で取得に<code>0.068ms</code>。データの件数が増えても、データの取得に時間がかかるようにはなっていない。いい感じに見える。</p>
<p>なおデータを 1000000 件でハッシュテーブルのサイズを 1（検索に<code>O(n)</code>かかるはず）にしたら、追加には<code>870.672ms</code>となり取得には<code>12.525ms</code>かかった（繰り返し測定してみると、早い時は 2ms くらいで終わる）。</p>
<p>上記の計測をオブジェクトに置き換えて</p>
<pre class="language-javascript" data-language="javascript"><code is:raw="" class="language-javascript"><span class="token keyword">const</span> dataLength <span class="token operator">=</span> <span class="token number">1000000</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> myHashTable <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">"set"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> key<span class="token punctuation">,</span> value<span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&#x3C;</span> dataLength<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  key <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> dataLength<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  value <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> dataLength<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  myHashTable<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">"set"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">"get"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
myHashTable<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">"get"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>としてみたろころ、データの追加には<code>1632.026ms</code>で、取得には<code>0.008ms</code>になった。繰り返し計測してみないと誤差の範囲かどうかは明確には言えないけど、ほぼ同じパフォーマンスのように思う。</p>
<p>さらに Map に置き換えてみた。</p>
<pre class="language-javascript" data-language="javascript"><code is:raw="" class="language-javascript"><span class="token keyword">const</span> dataLength <span class="token operator">=</span> <span class="token number">1000000</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> myHashTable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">"set"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> key<span class="token punctuation">,</span> value<span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&#x3C;</span> dataLength<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  key <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> dataLength<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  value <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> dataLength<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  myHashTable<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">"set"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">"get"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
myHashTable<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">"get"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>データの追加には<code>1178.558ms</code>で、取得には<code>0.006ms</code>になった。</p>
<p>そのほか参考</p>
<ul>
<li><a href="https://www.quora.com/What-is-a-good-hash-table-array-size">https://www.quora.com/What-is-a-good-hash-table-array-size</a></li>
<li><a href="http://srinvis.blogspot.com/2006/07/hash-table-lengths-and-prime-numbers.html">http://srinvis.blogspot.com/2006/07/hash-table-lengths-and-prime-numbers.html</a></li>
<li><a href="https://en.wikipedia.org/wiki/Hash_table">https://en.wikipedia.org/wiki/Hash_table</a></li>
</ul>
<p>以上。</p>  </div> <footer class="profile"> <div class="profile-inner"> <div class="profile__image"> <img src="/assets/icons/icon.svg" role="presentation" width="48" height="48" alt=""> </div> <h2 class="profile__heading">私について</h2> <div class="profile__content"> <div>Yutaka Yamaguchi</div> <div>
東京在住。TypeScript, Node.js,
        Reactなどフロンエンドが主力。Perlも書く。SwiftやRubyも過去には使ってた。過去のTOEIC
        860くらい。
</div> <ul class="profile__social-list"> <li class="profile__social-list-item"> <a href="https://twitter.com/memolog">X</a> </li> <li class="profile__social-list-item"> <a href="https://www.linkedin.com/in/yutakayamaguchi/">LinkedIn</a> </li> </ul> </div> </div> </footer> </article> </main> <aside class="related-posts"> <h2 class="header__title">📖 関連メモ</h2> <div> <article class="article-summary"> <header class="header"> <div> <time datetime="2014-08-30T06:47:00.000Z"> <span class="calendar-icon">📅</span> <span>2014年8月30日</span> </time> </div> <h3 class="header__title article__title"> <a href="/2014/08/convert_indexof_result_with_bitwise_operators.html">indexOf とビット演算子</a> </h3>  </header> <div class="content">String.prototype.indexOf() - JavaScript | MDNは、Stringの中の文字があったら、その文字の開始位置を返して、ない場合は「-1」を返します。</div> <div class="read-more"> <a href="/2014/08/convert_indexof_result_with_bitwise_operators.html">📖 続きを読む</a> </div> </article><article class="article-summary"> <header class="header"> <div> <time datetime="2018-08-01T05:23:27.000Z"> <span class="calendar-icon">📅</span> <span>2018年8月1日</span> </time> </div> <h3 class="header__title article__title"> <a href="/2018/about-typedarray-prototype-sort.html">TypedArray.prototype.sort について</a> </h3> <div class="header__feature" aria-hidden="true"> <div class="featured__image" style="background-color: #826c4e;"> <div style="background-color: #826c4e"> <img src="/assets/images/marcus-depaula-43304-unsplash/marcus-depaula-43304-unsplash.svg" alt role="presentation" loading="lazy" width="985" height="654"> </div> </div> <div class="featured__credit">Original photo by <a href="https://unsplash.com/photos/tk7OAxsXNL0?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText" target="_blank" rel="noopener" tabindex="-1">Marcus dePaula</a> on <a href="https://unsplash.com/?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText" target="_blank" rel="noopener" tabindex="-1">Unsplash</a>, edited with <a href="https://github.com/fogleman/primitive" target="_blank" rel="noopener" tabindex="-1">Primitive</a></div> </div> </header> <div class="content">前回の「Array.prototype.sort について」に引き続き、今度はTypedArrayのsortについて。実装は別だけど対応は基本的に同じなので簡単に。</div> <div class="read-more"> <a href="/2018/about-typedarray-prototype-sort.html">📖 続きを読む</a> </div> </article><article class="article-summary"> <header class="header"> <div> <time datetime="2025-04-10T23:15:00.000Z"> <span class="calendar-icon">📅</span> <span>2025年4月11日</span> </time> </div> <h3 class="header__title article__title"> <a href="/2025/generate-related-posts.html">記事に関連メモを出してみる</a> </h3> <div class="header__feature" aria-hidden="true"> <div class="featured__image" style="background-color: #d9c093;"> <img src="/assets/images/generate-related-posts/generate-related-posts.webp" srcset="/assets/images/generate-related-posts/generate-related-posts.webp, /assets/images/generate-related-posts/generate-related-posts@2x.webp 2x" role="presentation" loading="lazy" width="985" height="328" alt> </div> <div class="featured__credit">Image by <a href="https://chatgpt.com/" target="_blank" rel="noopener" tabindex="-1">ChatGPT</a></div> </div> </header> <div class="content">記事データをベクトル化して、関連記事（メモ）を表示できるか試してみた、というメモ。</div> <div class="read-more"> <a href="/2025/generate-related-posts.html">📖 続きを読む</a> </div> </article><article class="article-summary"> <header class="header"> <div> <time datetime="2018-07-14T11:32:41.000Z"> <span class="calendar-icon">📅</span> <span>2018年7月14日</span> </time> </div> <h3 class="header__title article__title"> <a href="/2018/complete-all-the-pwa-checklist.html">PWAのチェックリストを満たす</a> </h3> <div class="header__feature" aria-hidden="true"> <div class="featured__image" style="background-color: #6d6861;"> <div style="background-color: #6d6861"> <img src="/assets/images/cloudvisual-146380-unsplash/cloudvisual-146380-unsplash.svg" alt role="presentation" loading="lazy" width="985" height="734"> </div> </div> <div class="featured__credit">Original photo by <a href="https://unsplash.com/photos/sm8OE9daK2A?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText" target="_blank" rel="noopener" tabindex="-1">CloudVisual</a> on <a href="https://unsplash.com/?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText" target="_blank" rel="noopener" tabindex="-1">Unsplash</a>, edited with <a href="https://github.com/fogleman/primitive" target="_blank" rel="noopener" tabindex="-1">Primitive</a></div> </div> </header> <div class="content">たいして更新もしない個人のブログで Service Worker とか入れる必要まったくないと思いながらも、Lighthouse の結果を見るたびに「PWAのチェックリストだけ100点に至らない」というなんとも言えないモヤモヤ感があった。別にそんなに大変でもないんだから入れてしまえ、ということでPWAのチェックリストを満たすべく、Service Worker と App manifest に対応しました。</div> <div class="read-more"> <a href="/2018/complete-all-the-pwa-checklist.html">📖 続きを読む</a> </div> </article> </div> </aside> </div> </body></html>