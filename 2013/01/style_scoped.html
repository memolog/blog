<!doctype html>
<html lang="ja">
<head>
  <title>style要素のscoped属性 | メモログ</title>
    <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="preconnect" href="https://www.google-analytics.com">
  <link rel="shortcut icon" href="/assets/icons/icon-32.ico">
  <style>body {
  background-color: white;
  color: black;
  font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue",
    "Hiragino Kaku Gothic Pro", YuGothic, "Yu Gothic", Meiryo, sans-serif;
  margin: 0;
  padding: 0;
}

.header {
  margin: 0 auto;
  font-family: Garamond, "Times New Roman", serif;
}

.header_component_global {
  text-align: center;
  margin: 1em auto;
  max-width: 700px;
}

.header__title {
  margin: 0.2em 0 0.2em;
  font-size: 1.8em;
  font-weight: normal;
  vertical-align: bottom;
}

.header__title a,
.header__title > span {
  color: black;
  text-decoration: none;
  display: inline-block;
  background-color: #f5f2f0;
  padding: 5px;
}

.header_component_global .header__title {
  font-size: 1.2em;
}

.header_component_global .header__title a {
  text-decoration: none;
  color: black;
}

.main .header .header__title {
  position: sticky;
  top: 0;
  z-index: 100;
  opacity: 0.8;
  margin-bottom: 0;
}

.header__description {
  margin-top: 0;
  margin-bottom: 1em;
}

.header_component_global .header__description {
  color: #666;
  margin: 0 auto;
  padding: 0 5px;
}

.header__epigraph {
  font-style: italic;
  color: #666;
  margin: 0 auto;
  padding: 5px;
}

.container {
  width: 700px;
  margin: 0 auto 4em;
  padding: 0 15px;
  border-radius: 3px;
}

.content {
  font-size: 1.125em;
  line-height: 2em;
  background: white;
  color: #222;
  -webkit-font-smoothing: antialiased;
}

.content h2,
.content h3 {
  font-size: 1.4em;
  margin: 2em 0 1em 0;
  border-bottom: 1px solid #ddd;
}

.article-summary {
  margin-bottom: 3.5em;
}

.header time {
  display: inline-block;
  font-size: 0.9125em;
  color: #666;
}

.calendar-icon,
.author-icon {
  margin-right: 0.5em;
}

.content blockquote {
  border: 5px solid #ddd;
  background: #f9f9f9;
  margin: 1.5em 0;
  padding: 0 1em;
}

.content p > code,
.content li > code {
  background-color: #f5f2f0;
  display: inline-block;
  padding: 0 6px;
  border-radius: 0.3em;
  color: #444;
}

.content table {
  background: #e0e0e0;
}

.content th {
  background: #f0f0f0;
}

.content tr {
  background: #fff;
}

.content tr:nth-child(even) {
  background: #f0f0f0;
}

.content td {
  padding: 5px 1em;
  text-align: center;
}

.content code[class*="language-"] {
  color: #444;
}

.header__feature {
  margin: 0.5em 0 -0.5em;
  position: relative;
}

.header__feature img {
  overflow: hidden;
}

.featured__image {
  background: white;
  line-height: 0;
  max-height: 335px;
  overflow: hidden;
}

.featured__credit {
  color: #333;
  font-size: 0.825em;
  text-align: right;
  position: absolute;
  right: 0;
  bottom: 0;
  padding: 7px;
  background: #f0f0f0;
  opacity: 0.8;
}

.lazyload,
.lazyloading {
  opacity: 0.5;
}

.lazyloaded {
  opacity: 1;
  transition: opacity 2s 0.3s cubic-bezier(0.3, 0.18, 0.15, 1);
}

.content img {
  max-width: 100%;
}

.youtube-wrapper {
  position: relative;
  display: block;
  height: 0;
  padding: 0;
  overflow: hidden;
  padding-bottom: 56.25%;
}

.youtube-wrapper iframe {
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0;
  height: 100%;
  width: 100%;
  border: 0;
}

@media screen and (max-width: 500px) {
  .header__epigraph {
    display: none;
  }

  .header__title {
    font-size: 1.2em;
  }

  .content h2 {
    font-size: 1.2em;
  }

  .main .header .header__title {
    margin-bottom: 30px;
  }

  .header__feature {
    margin-top: -23px;
  }

  .featured__credit {
    margin-left: -15px;
    margin-right: -15px;
    position: relative;
  }
}

@media screen and (max-width: 700px) {
  .featured__image,
  .content__image,
  .content pre[class*="language-"],
  .youtube-wrapper {
    margin: 0 -15px;
  }
}

@media screen and (max-width: 700px) {
  .featured__image,
  .content__image,
  .content pre[class*="language-"] {
    margin: 0 -15px;
  }
}

/*
.content p a[href]::before {
  content: '🌐';
  width: 24px;
  display: inline-block;
}

.content p a[href].link-icon::before {
  content: '';
}

.content p a[href].no-link-icon::before {
  content: '';
  width: 0;
}

.content p a.link-icon {
  background-position-x: 4px;
  background-position-y: center;
  background-repeat: no-repeat;
}
*/

.post .writing-vertical {
  writing-mode: vertical-rl;
  font-family: serif;
  font-size: 1em;
  margin: 1.5em 0;
  column-count: 2;
  max-width: 700px;
  width: 102%;
  overflow: auto;
  height: 800px;
}

.post .writing-vertical p {
  margin: 0;
}

/*
.post .writing-vertical p a {
  padding-left: 0px;
  padding-top: 24px;
}
*/

.post .writing-vertical p:first-letter {
  margin-top: 1em;
}

.post .writing-vertical .link-icon {
  background-position-x: center;
  background-position-y: 5px;
}

.post .writing-vertical blockquote {
  border: none;
  margin: 0 0.5em;
  padding: 1em 0.5em;
  background: #f0f0f0;
}

@media screen and (max-width: 730px) {
  .container {
    width: 100%;
    box-sizing: border-box;
  }

  .post .writing-vertical {
    margin-left: 0;
    margin-right: 0;
    width: 100%;
  }

  .header__feature img {
    max-width: 100%;
    height: auto;
  }
}
</style>
  <script>window.lazyLoadOptions = {};</script>
  <link rel="preload" as="style" href="/css/global_async.css" onload="this.rel='stylesheet'">
  <link rel="alternate" href="http://feeds.feedburner.com/jp/memolog" title="Latest Articles" >
  <link rel="apple-touch-icon" href="/assets/icons/icon-192.png">
  <link rel="manifest" href="/manifest.json" >
  <meta name="theme-color" content="white">

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-955153-2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-955153-2');
  </script>
  <script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@graph":
    [
      {
        "@context": "http://schema.org",
        "@type": "Organization",
        "url": "http://memolog.org",
        "logo": "https://memolog.org/assets/icons/icon-1024.png"
      },
      {
        "@context": "http://schema.org",
        "@type": "Person",
        "name": "Yutaka Yamaguchi",
        "url": "http://memolog.org",
        "sameAs": [
          "https://www.facebook.com/yutaka.yamaguchi",
          "https://www.linkedin.com/in/yutakayamaguchi/",
          "https://twitter.com/memolog"
        ]
      }
    ]
  }
  </script>

  <meta name="description" content="Firefox Development Highlights - H.264 &amp; MP3 support on Windows, scoped stylesheets + more ✩Mozilla Hacks – the Web developer blog（日本語）にて、Firefoxのnightlyでstyle要素のscoped属性に対応したという話が出ていたので、試してみました。s">
<meta property="og:type" content="article">
<meta property="og:title" content="style要素のscoped属性">
<meta property="og:url" content="https://memolog.org/2013/01/style_scoped.html">
<meta property="og:site_name" content="メモログ">
<meta property="og:description" content="Firefox Development Highlights - H.264 &amp; MP3 support on Windows, scoped stylesheets + more ✩Mozilla Hacks – the Web developer blog（日本語）にて、Firefoxのnightlyでstyle要素のscoped属性に対応したという話が出ていたので、試してみました。s">
<meta property="og:locale" content="ja_JP">
<meta property="article:published_time" content="2013-01-27T13:05:00.000Z">
<meta property="article:modified_time" content="2024-02-20T21:19:33.328Z">
<meta property="article:author" content="Yutaka Yamaguchi">
<meta property="article:tag" content="css">
<meta property="article:tag" content="html">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@memolog">
<meta name="twitter:site" content="https://twitter.com/memolog">
<meta property="fb:app_id" content="168245123786587">
  <link rel="canonical" href="https://memolog.org/2013/01/style_scoped.html">
  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "BlogPosting",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://memolog.org/2013/01/style_scoped.html"
      },
      "headline": "style要素のscoped属性",
      
      "datePublished": "1359291900000",
      "dateModified": "1708463973328",
      "author": {
        "@type": "Person",
        "name": "Yutaka Yamaguchi"
      },
      "publisher": {
        "@type": "Organization",
        "name": "メモログ",
        "logo": {
          "@type": "ImageObject",
          "url": "https://memolog.org/assets/icons/icon-1024.png"
        }
      },
      "description": "Firefox Development Highlights - H.264 & MP3 support on Windows, scoped stylesheets + more ✩Mozilla Hacks – the Web developer blog（日本語）にて、Firefoxのnightlyでstyle要素のscoped属性に対応したという話が出ていたので、試してみました。style scoped動作確認用のcodepen。"
    }
  </script>
<meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="メモログ" type="application/atom+xml">
</head>
<body class="post">
    <header class="header header_component_global">
    <div class="header__icon" aria-hidden="true"><img src="/assets/icons/icon.svg" role="presentation" width="48" height="48" alt="icon" loading="lazy"></div>
    <h1 class="header__title header__title"><a href="/">メモログ</a></h1>
    <p class="header__description">塵が積もって山とならないメモのログ</p>
    <nav class="navigation navigation-global">
      <a href="/" class="navigation__link">📘 最新のメモ</a>
    </nav>
  </header>

  <div class="container">
    <main class="main">
      <article>
        <header class="header">
          <div>
            <time datetime="2013-01-27T13:05:00.000Z">
              <span class="calendar-icon">📅</span><span>2013年1月27日</span>
            </time>
          </div>
          <h2 class="header__title"><span>style要素のscoped属性</span></h2>
          
        </header>
        <div id="article-content" class="content "><p><a target="_blank" rel="noopener" href="https://hacks.mozilla.org/2013/01/firefox-development-highlights-h-264-mp3-support-on-windows-scoped-stylesheets-more/">Firefox Development Highlights - H.264 &amp; MP3 support on Windows, scoped stylesheets + more ✩Mozilla Hacks – the Web developer blog</a>（<a target="_blank" rel="noopener" href="https://dev.mozilla.jp/2013/01/firefox-development-highlights-h-264-mp3-support-on-windows-scoped-stylesheets-more/">日本語</a>）にて、<a target="_blank" rel="noopener" href="http://nightly.mozilla.org/">Firefoxのnightly</a>でstyle要素のscoped属性に対応したという話が出ていたので、試してみました。<a target="_blank" rel="noopener" href="http://codepen.io/memolog/pen/uedGg">style scoped動作確認用のcodepen</a>。</p>
<span id="more"></span>
<p><a target="_blank" rel="noopener" href="http://www.w3.org/TR/html5/document-metadata.html#attr-style-scoped">style scopeの仕様</a>によると、sytle scoped要素の親要素をルートとして、その範囲のみにstyleを適用させるみたいな感じ。親要素の最初のノードとして配置する必要がある（コメントノードなどinter-element whitespaceを除く）。</p>
<p>そして親要素のcontent modelは<a target="_blank" rel="noopener" href="http://www.w3.org/TR/html5/dom.html#transparent">transparent</a>であってはいけないらしい。代表的なのは<a target="_blank" rel="noopener" href="http://www.w3.org/TR/html5/text-level-semantics.html#the-a-element">a要素</a>（それ以外はinsとかmap要素がtransparentらしい）で、</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;a&gt;</span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">h1&#123; color:black &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;h1&gt;foobar&lt;/h1&gt;</span><br><span class="line">&lt;/a&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ということはできないことになる。a要素の中にdivとか何かtransparnetでないものを入れないといけない。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;a&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">h1&#123; color:black &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;h1&gt;foobar&lt;/h1&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/a&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>あと、@global at-ruleが定義されていて、@globalで制限されたCSSは通常のstyle要素と同じようにDocument全体に適用されるらしい（まだブラウザ上では試せない）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">@global&#123; div&#123; color:blue &#125; &#125;</span><br><span class="line">h1 &#123; width:95&amp;#x25;; &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;h1&gt;foobar&lt;/h1&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">blue</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>style scopedは、たとえば、この記事の中でだけ使いたいCSSなどを全体のCSSに配慮することなしに使うことができるという意味で便利。ドキュメント全体のCSSと連携するようなCSSが、個別の記事あるとメンテナンス大変だと思うけど。DOMとCSSの分離という点からもそもそもstyle属性は多用するものではないだろうけど、ウィジェット的な、独立分離が可能なパーツ的なものの場合には使いどころもあると思われる（iframe使えば良いかもしれないけど）。</p>
<p>あと、style scopedではなくても、親要素にid属性つけてそれをCSSで指定すれば同じようなことはできなくもない（style要素でインラインでする必要もないけど）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;foobar&quot;&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">#foobar h1&#123; color:black &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;h1&gt;foobar&lt;/h1&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>CSSのパフォーマンス的なところは不明ですが、scoped属性あるなしに関わらず、<a target="_blank" rel="noopener" href="http://www.w3.org/TR/html5/document-metadata.html#styling">W3CのStyleの仕様では</a>、style要素で@importなどでリソースを参照しない場合は同期実行されるので、レンダリングは一時的にブロックされる、かもしれない。</p>
<blockquote>
<p>When a style sheet is ready to be applied, its style sheet ready flag must be set. If the style sheet referenced no other resources (e.g. it was an internal style sheet given by a style element with no @import rules), then the style rules must be synchronously made available to script; otherwise, the style rules must only be made available to script once the event loop reaches its “update the rendering” step.</p>
</blockquote>
<p>多用するものではないと思いますけど、ここだというときに使えると、いいですね！</p>
</div>
        <footer class="profile">
  <div class="profile-inner">
    <div class="profile__image"><img src="/assets/icons/icon.svg" role="presentation" width="48" height="48" alt="icon"></div>
    <h2 class="profile__heading">私について</h2>
    <div class="profile__content">
      <div>Yutaka Yamaguchi</div>
      <div>東京在住。TypeScript, Node.js, Reactなどフロンエンドが主力。Perlも書く。SwiftやRubyも過去には使ってた。万年英語勉強中</div>
      <ul class="profile__social-list">
        <li class="profile__social-list-item"><a target="_blank" rel="noopener" href="https://twitter.com/memolog">Twitter</a></li>
        <li class="profile__social-list-item"><a target="_blank" rel="noopener" href="https://www.linkedin.com/in/yutakayamaguchi/">LinkedIn</a></li>
        <li class="profile__social-list-item"><a target="_blank" rel="noopener" href="https://www.facebook.com/yutaka.yamaguchi">Facebook</a></li>
      </ul>
    </div>
  </div>
</footer>

      </article>
    </main>
  </div>
  <script>
  // http://css-tricks.com/favicons-next-to-external-links/
  (function (){
    'use strict';
    if (/googlebot/i.test(navigator.userAgent)) {
      return;
    }
    window.addEventListener("DOMContentLoaded", () => {
      const links = document.querySelectorAll('.content p a');
      const linkLength = links && links.length || 0;
      for (var i=0; i<linkLength; i++){
        const link = links[i];
        const hostname = link.hostname;
        if (hostname) {
          const children = link.children || [];
          const firstChild = children && children[0];
          if (firstChild && firstChild.tagName === 'IMG') {
            // For old amazon image link
            if (link.hostname === 'www.amazon.co.jp') {
              link.style.float = 'left';
              link.style.marginRight = '1em';
              link.style.paddingLeft = '0';
            }
            // link.classList.add('no-link-icon');
            continue;
          }

          // link.classList.add('link-icon');
          // link.style.backgroundImage = `url(https://www.google.com/s2/favicons?domain=${hostname})`;
        }
      }
    });
  })();
</script>
<script>
  if ('serviceWorker' in navigator) {
    // navigator.serviceWorker.register('/service-worker.js');
  }
</script>

</body>
</html>
